---
title: "Car Sale Features Per Year since 2000"
format: html
editor: visual
execute: 
  warning: false
  message: false
  echo: false
---

```{r}
library(tidyverse)
library(scales)
library(ggthemes)

car_data <- read.csv("data/car-dataset.csv", sep = ";")

car_data <- car_data %>%
  mutate(
    Year = as.factor(Year),
    Country = as.factor(Country),
    Car_Brand = as.factor(Car_Brand),
    Fuel_Type = as.factor(Fuel_Type),
    Units_Sold = as.numeric(Units_Sold),
    Average_Price = as.numeric(Average_Price)
)
```

```{r plot1}
car_data %>%
  group_by(Year) %>%
  summarise(Total_Sold = sum(Units_Sold, na.rm = TRUE)) %>%
  ggplot(aes(x = Year, y = Total_Sold, group = 1)) +
  geom_line(color = "darkblue", size = 1.2) +
  geom_point(color = "red", size = 3) +
  labs(title = "Total Units Sold Over Time", x = "Year", y = "Units Sold") +
  scale_y_continuous(labels = comma) +
  theme_minimal(base_size = 14) +
  theme(axis.text.x = element_text( angle=90,hjust = 1, size=12, color="black"))

```

```{r plot4}
# Get most sold fuel type per country and year
most_sold_fuel_country_year <- car_data %>%
  group_by(Year, Country, Fuel_Type) %>%
  summarise(Total_Units_Sold = sum(Units_Sold, na.rm = TRUE), .groups = "drop") %>%
  group_by(Year, Country) %>%
  slice_max(Total_Units_Sold, n = 1)  # only most sold fuel type

# Plot
ggplot(most_sold_fuel_country_year, aes(x = Year, y = fct_rev(Country), fill = Fuel_Type)) +
  geom_tile(color = "white", width = 0.9, height = 0.9) +
  scale_fill_brewer(palette = "Set2", name = "Fuel Type") +
  labs(
    title = "Most Sold Fuel Type by Country and Year",
    x = "Year", y = "Country"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    panel.grid = element_blank(),
    axis.text.x = element_text(angle = 90, hjust = 1, size = 11),
    axis.text.y = element_text(size = 11),
    legend.position = "right",
    legend.title = element_text(size = 12),
    legend.text = element_text(size = 11)
  )
```

```{r plot2}
car_data %>%
  group_by(Year) %>%
  summarise(Avg_Price = mean(Average_Price, na.rm = TRUE)) %>%
  ggplot(aes(x = as.numeric(as.character(Year)), y = Avg_Price)) +
  geom_line(color = "#2E86AB", size = 1.5) +
  geom_point(color = "#E74C3C", size = 3) +
  geom_smooth(method = "loess", se = FALSE, color = "darkgreen", linetype = "dashed") +
  labs(title = "Trend of Average Car Price Over the Years", x = "Year", y = "Average Price (USD)") +
  scale_y_continuous(labels = dollar) +
  theme_minimal(base_size = 14) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 12),
    axis.text.y = element_text(size = 12),
    panel.grid.minor = element_blank()
  )

```


```{r plot3, fig.width=10, fig.height=6}
# Summarize: Get most sold car color per year
most_sold_colors <- car_data %>%
  group_by(Year, Car_Color) %>%
  summarise(Units_Sold = sum(Units_Sold, na.rm = TRUE), .groups = "drop") %>%
  group_by(Year) %>%
  slice_max(Units_Sold, n = 1)

# Plot: Simple bar chart with clean design
ggplot(most_sold_colors, aes(x = Year, y = Units_Sold, fill = Car_Color)) +
  geom_col(width = 0.7, show.legend = FALSE) +
  geom_text(aes(label = Car_Color), vjust = -0.5, size = 3.5) +
  labs(
    title = "Most Popular Car Color Each Year (by Units Sold)",
    x = "Year",
    y = "Units Sold"
  ) +
  scale_y_continuous(labels = scales::comma, expand = expansion(mult = c(0, 0.1))) +
  theme_minimal(base_size = 14) +
  theme(
    axis.text.x = element_text(angle = 75, hjust = 1),
    plot.title = element_text(face = "bold", size = 16, hjust = 0.5)
  )

```
