---
title: "Car Sales by Year: Visual Insights"
format: html
editor: visual
---

```{r}
library(tidyverse)
library(scales)
library(ggthemes)

# Load data
car_data <- read.csv("data/car-dataset.csv", sep = ";")

# Clean and prepare
car_data <- car_data %>%
  mutate(
    Year = as.factor(Year),
    Country = as.factor(Country),
    Car_Brand = as.factor(Car_Brand),
    Fuel_Type = as.factor(Fuel_Type),
    Units_Sold = as.numeric(Units_Sold),
    Average_Price = as.numeric(Average_Price)
  )
#plot1
car_data %>%
  group_by(Year) %>%
  summarise(Total_Sold = sum(Units_Sold, na.rm = TRUE)) %>%
  ggplot(aes(x = Year, y = Total_Sold, group = 1)) +
  geom_line(color = "darkblue", size = 1.2) +
  geom_point(color = "red", size = 3) +
  labs(title = "Total Units Sold Over Time", x = "Year", y = "Units Sold") +
  scale_y_continuous(labels = comma) +
  theme_minimal(base_size = 14) +
  theme(axis.text.x = element_text( angle=90,hjust = 1, size=12, color="black"))

#plot2
car_data %>%
  group_by(Year) %>%
  summarise(Avg_Price = mean(Average_Price, na.rm = TRUE)) %>%
  ggplot(aes(x = Year, y = Avg_Price, fill = Year)) +
  geom_col(show.legend = FALSE) +
  labs(title = "Average Car Price by Year", x = "Year", y = "Average Price (USD)") +
  scale_y_continuous(labels = dollar) +
  theme_classic(base_size = 14) +
  theme(axis.text.x = element_text( angle=90,hjust = 1, size=12, color="black"))

#plot3 - Car Color vs Units Sold
car_data %>%
  group_by(Car_Color) %>%
  summarise(Total_Units_Sold = sum(Units_Sold, na.rm = TRUE), .groups = "drop") %>%
  ggplot(aes(x = reorder(Car_Color, Total_Units_Sold), y = Total_Units_Sold, fill = Car_Color)) +
  geom_col(show.legend = FALSE) +
  labs(title = "Total Units Sold by Car Color", x = "Car Color", y = "Total Units Sold") +
  scale_y_continuous(labels = comma) +
  coord_flip() +
  theme_minimal(base_size = 14) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 12, color = "black"))
 
library(ggplot2)
library(dplyr)
library(scales)
library(forcats)

library(ggplot2)
library(dplyr)
library(forcats)
library(RColorBrewer)

# Get most sold car brand for each country and year
most_sold_brand_country_year <- car_data %>%
  group_by(Year, Country, Car_Brand) %>%
  summarise(Total_Units_Sold = sum(Units_Sold, na.rm = TRUE), .groups = "drop") %>%
  group_by(Year, Country) %>%
  slice_max(Total_Units_Sold, n = 1)  # only most sold brand

# Plot with legend for brand colors
ggplot(most_sold_brand_country_year, aes(x = Year, y = fct_rev(Country), fill = Car_Brand)) +
  geom_tile(color = "white", width = 0.9, height = 0.9) +
  geom_text(aes(label = Car_Brand), color = "black", size = 3, fontface = "bold") +
  scale_fill_manual(
    values = setNames(colorRampPalette(brewer.pal(12, "Set3"))(length(unique(most_sold_brand_country_year$Car_Brand))),
                      unique(most_sold_brand_country_year$Car_Brand)),
    name = "Car Brand"
  ) +
  labs(
    title = "Most Sold Car Brand by Country and Year",
    x = "Year", y = "Country"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    panel.grid = element_blank(),
    axis.text.x = element_text(angle = 45, hjust = 1, size = 11),
    axis.text.y = element_text(size = 11),
    legend.position = "right",
    legend.title = element_text(size = 12),
    legend.text = element_text(size = 11)
  )

```