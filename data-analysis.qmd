---
title: "Data Analysis of Surface Change Rates"
format: html
toc: true
page-layout: full
execute:
  echo: false
---

```{r}
#| message: false

# Load necessary libraries
library(tidyverse)
library(readr)
library(ggplot2)

# Load the dataset
weather <- read_csv("data/temperature.csv")  # Adjust the path if needed

# Overview of the dataset
glimpse(weather)

# Check for missing values
weather_missing_summary <- weather %>%
  summarise(across(everything(), ~sum(is.na(.)))) %>%
  pivot_longer(cols = everything(), names_to = "Variable", values_to = "Missing_Values") %>%
  filter(Missing_Values > 0)

# Display missing value summary
weather_missing_summary

# Reshape the dataset: pivot longer for years
weather_long <- weather %>%
  pivot_longer(
    cols = `1970`:`2021`,
    names_to = "Year",
    values_to = "ChangeRate"
  ) %>%
  mutate(Year = as.integer(Year))

# Basic statistics
weather_stats <- weather_long %>%
  group_by(Year) %>%
  summarise(
    Mean_Change = mean(ChangeRate, na.rm = TRUE),
    Median_Change = median(ChangeRate, na.rm = TRUE),
    Min_Change = min(ChangeRate, na.rm = TRUE),
    Max_Change = max(ChangeRate, na.rm = TRUE),
    SD_Change = sd(ChangeRate, na.rm = TRUE),
    .groups = 'drop'
  )

# Display yearly statistics
weather_stats

# Plot average change rate over years
ggplot(weather_stats, aes(x = Year, y = Mean_Change)) +
  geom_line(color = "blue", size = 1) +
  geom_point(color = "darkblue") +
  labs(
    title = "Average Surface Change Rate Over Years",
    x = "Year",
    y = "Average Change Rate"
  ) +
  theme_minimal()

# Identify top 10 countries with highest average change rate
top_countries <- weather_long %>%
  group_by(`Country Name`) %>%
  summarise(
    Avg_Change = mean(ChangeRate, na.rm = TRUE)
  ) %>%
  arrange(desc(Avg_Change)) %>%
  slice_head(n = 10)

# Display top 10 countries
top_countries

# Plot top 10 countries
ggplot(top_countries, aes(x = reorder(`Country Name`, Avg_Change), y = Avg_Change)) +
  geom_col(fill = "steelblue") +
  coord_flip() +
  labs(
    title = "Top 10 Countries by Average Surface Change Rate (1970-2021)",
    x = "Country",
    y = "Average Change Rate"
  ) +
  theme_minimal()

# Yearly missing values plot
weather_long %>%
  group_by(Year) %>%
  summarise(Missing = sum(is.na(ChangeRate))) %>%
  ggplot(aes(x = Year, y = Missing)) +
  geom_line(color = "red", size = 1) +
  geom_point(color = "darkred") +
  labs(
    title = "Number of Missing Values Over the Years",
    x = "Year",
    y = "Count of Missing Values"
  ) +
  theme_minimal()

# Distribution of change rates
ggplot(weather_long, aes(x = ChangeRate)) +
  geom_histogram(bins = 50, fill = "lightblue", color = "black") +
  labs(
    title = "Distribution of Surface Change Rates",
    x = "Change Rate",
    y = "Frequency"
  ) +
  theme_minimal()

# Boxplot by decade
weather_long %>%
  mutate(Decade = paste0(floor(Year / 10) * 10, "s")) %>%
  ggplot(aes(x = Decade, y = ChangeRate)) +
  geom_boxplot(fill = "lightgreen") +
  labs(
    title = "Surface Change Rates by Decade",
    x = "Decade",
    y = "Change Rate"
  ) +
  theme_minimal()

```